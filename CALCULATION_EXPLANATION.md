# 收益计算说明

## 修改内容

本次更新对收益计算方式进行了重要改进，将收益分为三类显示：

1. **账面收益（未实现收益）** - 当前持仓的潜在盈亏
2. **已实现收益** - 已经通过卖出获得的实际盈亏
3. **总收益** - 以上两者的总和

## 计算方法

### 基础数据收集
- 总买入数量（totalBuyAmount）
- 总买入成本（totalBuyCost）
- 总卖出数量（totalSellAmount）
- 总卖出收入（totalSellRevenue）
- 当前持仓数量（totalHoldings）= 总买入 - 总卖出

### 平均成本法
系统使用平均成本法来计算收益：

**平均买入成本** = 总买入成本 ÷ 总买入数量

### 收益计算

#### 1. 账面收益（未实现收益）
这是当前持仓的潜在盈亏，还没有通过卖出实现。

```
当前持仓成本 = 当前持仓数量 × 平均买入成本
当前市值 = 当前持仓数量 × 当前BTC价格
账面收益 = 当前市值 - 当前持仓成本
账面收益率 = (账面收益 ÷ 当前持仓成本) × 100%
```

#### 2. 已实现收益
这是通过卖出操作已经获得的实际盈亏。

```
卖出成本 = 卖出数量 × 平均买入成本
已实现收益 = 总卖出收入 - 卖出成本
已实现收益率 = (已实现收益 ÷ 卖出成本) × 100%
```

#### 3. 总收益
```
总收益 = 账面收益 + 已实现收益
总收益率 = (总收益 ÷ 总买入成本) × 100%
```

### 验证公式
```
总收益 = (当前市值 + 总卖出收入) - 总买入成本
```

## 示例计算

假设以下交易记录：

| 日期 | 类型 | 数量(BTC) | 价格($) | 金额($) |
|------|------|-----------|---------|---------|
| 2023-12-03 | 买入 | 0.05 | 38,000 | 1,900 |
| 2024-01-03 | 买入 | 0.03 | 42,000 | 1,260 |
| 2024-02-03 | 买入 | 0.02 | 45,000 | 900 |
| 2024-03-05 | 卖出 | 0.02 | 62,000 | 1,240 |

**假设当前BTC价格：$50,000**

### 计算过程：

1. **基础数据**
   - 总买入数量：0.1 BTC
   - 总买入成本：$4,060
   - 平均买入成本：$40,600/BTC
   - 总卖出数量：0.02 BTC
   - 总卖出收入：$1,240
   - 当前持仓：0.08 BTC

2. **账面收益（未实现）**
   - 当前持仓成本：0.08 × $40,600 = $3,248
   - 当前市值：0.08 × $50,000 = $4,000
   - 账面收益：$4,000 - $3,248 = **$752 (+23.15%)**

3. **已实现收益**
   - 卖出成本：0.02 × $40,600 = $812
   - 已实现收益：$1,240 - $812 = **$428 (+52.71%)**

4. **总收益**
   - 总收益：$752 + $428 = **$1,180 (+29.06%)**

5. **验证**
   - 总回收：$1,240（卖出）+ $4,000（市值）= $5,240
   - 总投入：$4,060
   - 总收益：$5,240 - $4,060 = **$1,180** ✓

## 界面显示

修改后的界面在"持仓统计"部分显示：

- **持仓数量**：0.08000000 BTC
- **平均成本**：$40,600.00
- **总投入**：$2,820.00（净投入 = 买入 - 卖出收入）
- **当前市值**：$4,000.00
- **账面收益（未实现）**：$752.00 (+23.15%)
- **已实现收益**：$428.00 (+52.71%)
- **总收益**：$1,180.00 (+29.06%)

## 优点

1. **更清晰**：用户可以清楚地看到已经赚到的钱和还在账面上的盈亏
2. **更准确**：使用平均成本法，符合大多数投资者的实际情况
3. **易于理解**：分开显示让投资决策更明确
4. **便于规划**：可以更好地规划何时卖出、是否需要止盈等

## 注意事项

- 系统使用**平均成本法**计算，不使用FIFO（先进先出）或LIFO（后进先出）
- 导入旧数据时，计算会自动按照新的逻辑处理
- 所有数据仍然存储在浏览器本地，记得定期备份
